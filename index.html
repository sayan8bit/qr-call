<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PeerJS Video Call</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
      body {
        font-family: Arial;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }
      input,
      button {
        margin: 8px;
        padding: 8px;
        font-size: 16px;
      }
      video {
        width: 45%;
        margin: 10px;
        border: 2px solid black;
      }
      .videos {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <h2>PeerJS Video Call (Mobile â†” PC)</h2>
    <p><b>Your ID:</b> <span id="my-id">Loading...</span></p>
    <input id="peer-id" placeholder="Enter peer ID" />
    <button id="call-btn">Start Call</button>
    <div class="videos">
      <video id="local-video" autoplay muted></video>
      <video id="remote-video" autoplay></video>
    </div>

    <script>
      const myIdSpan = document.getElementById("my-id");
      const callBtn = document.getElementById("call-btn");
      const peerIdInput = document.getElementById("peer-id");
      const localVideo = document.getElementById("local-video");
      const remoteVideo = document.getElementById("remote-video");

      let localStream;

      // Create a peer with a fixed ID (shorter)
      const myId = "user-" + Math.random().toString(36).substring(2, 6);
      const peer = new Peer(myId, {
        host: "0.peerjs.com", // Public PeerServer
        port: 443,
        path: "/",
        secure: true,
        config: {
          iceServers: [
            { urls: "stun:stun.l.google.com:19302" }, // Public STUN
            {
              urls: "turn:openrelay.metered.ca:80",
              username: "openrelayproject",
              credential: "openrelayproject",
            },
          ],
        },
      });

      peer.on("open", (id) => {
        myIdSpan.textContent = id;
        console.log("Connected with ID:", id);
      });

      peer.on("error", (err) => {
        alert("Peer error: " + err);
        console.error(err);
      });

      navigator.mediaDevices
        .getUserMedia({ video: true, audio: true })
        .then((stream) => {
          localStream = stream;
          localVideo.srcObject = stream;
        })
        .catch((err) => {
          alert("Error accessing camera/mic: " + err.message);
        });

      callBtn.onclick = () => {
        const otherId = peerIdInput.value.trim();
        if (!otherId || !localStream) return alert("Enter a valid ID");

        const call = peer.call(otherId, localStream);
        call.on("stream", (remoteStream) => {
          remoteVideo.srcObject = remoteStream;
        });

        call.on("close", () => {
          alert("Call ended.");
        });
      };

      peer.on("call", (call) => {
        call.answer(localStream);
        call.on("stream", (remoteStream) => {
          remoteVideo.srcObject = remoteStream;
        });
      });
    </script>
  </body>
</html>
