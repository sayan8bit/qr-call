<!DOCTYPE html>
<html>
  <head>
    <title>PeerJS Audio Call</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
        background: #f5f5f5;
        text-align: center;
      }
      input,
      button {
        padding: 10px;
        margin: 5px;
      }
      audio {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h2>ðŸ”Š PeerJS Audio Call</h2>
    <p>Your ID: <span id="my-id"></span></p>
    <input type="text" id="peer-id" placeholder="Enter peer ID to call" />
    <button onclick="startCall()">Call</button>
    <button onclick="endCall()">End Call</button>

    <h3>Status: <span id="status">Idle</span></h3>
    <audio id="remoteAudio" autoplay></audio>

    <script>
      let peerId = localStorage.getItem("fixed-peer-id");
      if (!peerId) {
        peerId = "user-" + Math.random().toString(36).substring(2, 6);
        localStorage.setItem("fixed-peer-id", peerId);
      }

      const peer = new Peer(peerId);
      let currentCall = null;

      peer.on("open", (id) => {
        document.getElementById("my-id").textContent = id;
      });

      peer.on("call", (call) => {
        document.getElementById("status").textContent = "Incoming Call...";
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
          call.answer(stream);
          document.getElementById("status").textContent = "Call Answered";
          call.on("stream", (remoteStream) => {
            document.getElementById("remoteAudio").srcObject = remoteStream;
          });
          call.on("close", () => {
            document.getElementById("status").textContent = "Call Ended";
            document.getElementById("remoteAudio").srcObject = null;
          });
          currentCall = call;
        });
      });

      function startCall() {
        const otherId = document.getElementById("peer-id").value;
        if (!otherId) return alert("Enter a peer ID!");
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
          const call = peer.call(otherId, stream);
          document.getElementById("status").textContent = "Calling...";
          call.on("stream", (remoteStream) => {
            document.getElementById("remoteAudio").srcObject = remoteStream;
            document.getElementById("status").textContent = "In Call";
          });
          call.on("close", () => {
            document.getElementById("status").textContent = "Call Ended";
            document.getElementById("remoteAudio").srcObject = null;
          });
          currentCall = call;
        });
      }

      function endCall() {
        if (currentCall) {
          currentCall.close();
          currentCall = null;
          document.getElementById("status").textContent = "Call Ended";
          document.getElementById("remoteAudio").srcObject = null;
        }
      }
    </script>
  </body>
</html>
