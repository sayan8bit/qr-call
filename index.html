<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PeerJS Video Call</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
      body {
        font-family: Arial;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
      }
      video {
        width: 45%;
        border: 2px solid black;
        margin: 10px;
      }
      input,
      button {
        margin: 5px;
        padding: 5px;
      }
    </style>
  </head>
  <body>
    <h2>PeerJS Video Call Demo</h2>
    <div>Your ID: <span id="my-id"></span></div>
    <input id="friend-id" placeholder="Enter friend's ID" />
    <button id="call-btn">Call</button>
    <div>
      <video id="local-video" autoplay muted></video>
      <video id="remote-video" autoplay></video>
    </div>

    <script>
      const myId = "user-" + Math.random().toString(36).substring(2, 9);
      const peer = new Peer(myId);

      const localVideo = document.getElementById("local-video");
      const remoteVideo = document.getElementById("remote-video");
      const friendIdInput = document.getElementById("friend-id");
      const callBtn = document.getElementById("call-btn");

      document.getElementById("my-id").textContent = myId;

      let localStream;

      // Get video/audio stream
      navigator.mediaDevices
        .getUserMedia({ video: true, audio: true })
        .then((stream) => {
          localStream = stream;
          localVideo.srcObject = stream;
        })
        .catch((err) => alert("Camera/Microphone error: " + err));

      // When another peer calls you
      peer.on("call", (call) => {
        call.answer(localStream);
        call.on("stream", (remoteStream) => {
          remoteVideo.srcObject = remoteStream;
        });
      });

      // Call button click
      callBtn.onclick = () => {
        const friendId = friendIdInput.value.trim();
        if (!friendId || !localStream) return alert("Missing ID or stream");

        const call = peer.call(friendId, localStream);
        call.on("stream", (remoteStream) => {
          remoteVideo.srcObject = remoteStream;
        });
      };
    </script>
  </body>
</html>
